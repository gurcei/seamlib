#OUTPUT "SEAMLIB"'--------.DECLARES'--------#DECLARE FIDX, FRAMEØCOUNT, ANIMØCOUNT#DECLARE BKPØD054&, BKPØD058&, BKPØD059&, BKPØD05E&#DECLARE MYØERR$, K, IDX, X, Y, VALUE#DECLARE CHRØWIDTH(100), CHRØHEIGHT(100), CHARØIDX(100)#DECLARE OBJX, OBJY, OLDYY, MINYY, MAXYY, YYBOT #DECLARE A$, YY, OFFSY'-------.DEFINES'-------#DEFINE À≈ŸØ≈”√¡–≈ = CHR$(27)#DEFINE À≈ŸØ’– = "ë"#DEFINE À≈ŸØƒœ◊Œ = ""#DEFINE À≈ŸØÃ≈∆‘ = "ù"#DEFINE À≈ŸØ“…«»‘ = ""#DEFINE À≈ŸØÕ≈«¡Ø— = "´"#DEFINE ◊…ƒ‘» = 200#DEFINE …Œ÷¡Ã…ƒ = -666TRAP RUNSTOPØTRAPPER'----.MAIN'----  GOSUB INIT  FIDX = 0  GOSUB STAGEØOBJECT  GOSUB USERØINPUT  END'----.INIT'----  BANK 128  KEY OFF  ' HARD-CODING A FEW VALUES THAT WILL BE VARIABLE IN FUTURE  FIDX = 0  CHRØWIDTH(0) = 3  CHRØHEIGHT(0) = 3  CHARØIDX(0) = $1008  FRAMEØCOUNT = 1  ANIMØCOUNT = 0  OLDYY = …Œ÷¡Ã…ƒ  PRINT "ì";À≈ŸØ≈”√¡–≈;"5";    BKPØD054& = PEEK($D054)  BKPØD058& = PEEK($D058)  BKPØD059& = PEEK($D059)  BKPØD05E& = PEEK($D05E)  ' SET ”≈¡Õ MODE √»“16 + ∆√Ã“»…  SETBIT $D054, 0  SETBIT $D054, 2  WPOKE $D058, ◊…ƒ‘»  POKE $D05E, ◊…ƒ‘» / 2  POKE $D021, 14  POKE $D020, 0  ' $1000 = SOLID FCM CHAR  FOR K = 0 TO 63    POKE $40000 + K, $FF  NEXT K  ' $1001 = BOX CHAR  FOR K = 0 TO 63    IF INT(K / 8) = 0 OR INT(K / 8) = 7 THEN POKE $40040 + K, $FF:GOTO NXT    IF MOD(K, 8) = 0 OR MOD(K, 8) = 7 THEN POKE $40040 + K, $FF:GOTO NXT    POKE $40040 + K, $00.NXT  NEXT K  ' $1002 = TL BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7    VALUE = $FF    IF Y = 0 THEN VALUE = $01    IF X = 0 THEN VALUE = $01    IF Y = 7 AND X = 7 THEN VALUE = $01    POKE $40080 + IDX, VALUE    IDX = IDX + 1    NEXT X  NEXT Y  ' $1003 = T BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $FF      IF Y = 0 THEN VALUE = $01      IF Y = 7 AND X = 7 THEN VALUE = $01      POKE $400C0 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1004 = L BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $FF      IF X = 0 THEN VALUE = $01      IF Y = 7 AND X = 7 THEN VALUE = $01      POKE $40100 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1005 = M BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $FF      IF Y = 7 AND X = 7 THEN VALUE = $01      POKE $40140 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1006 = L LINE  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $00      IF X = 0 THEN VALUE = $01      POKE $40180 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1007 = T LINE  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $00      IF Y = 0 THEN VALUE = $01      POKE $401C0 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  RETURN'---------------.RUNSTOPØTRAPPER'---------------  ' IF ER<>30 THEN RESUME  ' IGNORE EVERYTHING EXCEPT RUN/STOP  MYØERR$ = "?" + ERR$(ER) + " IN LINE " + STR$(EL).CLEANUP  PRINT "ì";MYØERR$  TRAP  POKE $D054, BKPØD054&  POKE $D058, BKPØD058&  POKE $D059, BKPØD059&  POKE $D05E, BKPØD05E&  END'------------.STAGEØOBJECT'------------  FOR Y = 0 TO 49    ' PREPARE INITIAL GOTOX CHAR    POKE $FF80000 + Y * ◊…ƒ‘» + 160, %10010000    WPOKE $40800 + Y * ◊…ƒ‘» + 160, 80 * 8  ' KEEP OFF-SCREEN INITIALLY    ' PREPARE ENDING GOTOX CHAR    POKE $FF80000 + Y * ◊…ƒ‘» + 160 + (CHRØWIDTH(FIDX) + 1) * 2, %10010000    WPOKE $40800 + Y * ◊…ƒ‘» + 160 + (CHRØWIDTH(FIDX) + 1) * 2, 80 * 8  NEXT Y  GOSUB DRAWØOBJECT  RETURN'----------.USERØINPUT'----------  DO WHILE 1    GOSUB DRAWØOBJECT    GET KEY A$    IF A$ = À≈ŸØÃ≈∆‘ THEN GOSUB HANDLEØLEFT    IF A$ = À≈ŸØ“…«»‘ THEN GOSUB HANDLEØRIGHT    IF A$ = À≈ŸØ’– THEN GOSUB HANDLEØUP    IF A$ = À≈ŸØƒœ◊Œ THEN GOSUB HANDLEØDOWN    IF A$ = À≈ŸØÕ≈«¡Ø— THEN GOTO CLEANUP  LOOP  RETURN.DRAWØOBJECT'-----------  YY = INT(OBJY / 8)  YYBOT = YY + CHRØHEIGHT(FIDX) ' - 1  OFFSY = MOD(OBJY, 8)  ' CLEAR PRIOR POSITION (IF NEEDBE)  IF OLDYY <> …Œ÷¡Ã…ƒ AND YY <> OLDYY THEN BEGIN    MINYY = OLDYY    MAXYY = OLDYY + CHRØHEIGHT(FIDX) ' - 1    IF MINYY < YY AND YY < MAXYY THEN MAXYY = YY - 1    IF MINYY < YYBOT AND YYBOT < MAXYY THEN MINYY = YYBOT + 1    ' HIDE THESE ROWS OFF-SCREEN    FOR Y = MINYY TO MAXYY      WPOKE $40800 + Y * ◊…ƒ‘» + 160, 80 * 8     NEXT Y  BEND  ' DRAW CHARS ON DESIRED YROWS, AND AT RIGHT OBJX POSITION  IDX = CHARØIDX(FIDX)  FOR X = 0 TO CHRØWIDTH(FIDX) - 1    FOR Y = 0 TO CHRØHEIGHT(FIDX) - 1      WPOKE $40800 + (YY + Y) * ◊…ƒ‘» + 162 + X * 2, IDX      ' COPY LAST Y-LINE AN EXTRA LINE BELOW (TO HELP WITH Y SCROLLING)      IF Y = CHRØHEIGHT(FIDX) - 1 THEN BEGIN        WPOKE $40800 + (YY + Y + 1) * ◊…ƒ‘» + 162 + X * 2, IDX      BEND      IDX = IDX + 1    NEXT Y  NEXT X  ' HANDLE NEGATIVE X  X = OBJX  IF OBJX < 0 THEN X = 1024 + OBJX  K = X + (OFFSY * 32 + 16) * 256  ' SET INITIAL ROWMASK  POKE $FF80000 + YY * ◊…ƒ‘» + 160, %10011000  POKE $FF80000 + YY * ◊…ƒ‘» + 160 + 1, 255 << OFFSY AND 255  ' SET INITIAL GOTOX CHAR  FOR Y = YY TO YY + CHRØHEIGHT(FIDX) - 1    IF Y <> YY THEN BEGIN      POKE $FF80000 + Y * ◊…ƒ‘» + 160, %10010000    BEND    WPOKE $40800 + Y * ◊…ƒ‘» + 160, K  NEXT Y  ' SET FINAL YOFFS  K = X + ( ((8-OFFSY) AND 7) * 32) * 256  WPOKE $40800 + YYBOT * ◊…ƒ‘» + 160, K  ' SET FINAL ROWMASK  POKE $FF80000 + YYBOT * ◊…ƒ‘» + 160, %10011000  POKE $FF80000 + YYBOT * ◊…ƒ‘» + 160 + 1, 255 >> (8 - OFFSY) AND 255  OLDYY = YY  RETURN'-----------.HANDLEØLEFT'-----------  OBJX = OBJX - 1  RETURN'------------.HANDLEØRIGHT'------------  OBJX = OBJX + 1  RETURN'---------.HANDLEØUP'---------  OBJY = OBJY - 1  RETURN'-----------.HANDLEØDOWN'-----------  OBJY = OBJY + 1  RETURN