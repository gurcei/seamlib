#OUTPUT "SEAMDRAW"'--------.DECLARES'--------#DECLARE BKPØD054&, BKPØD058&, BKPØD059&, BKPØD05E&#DECLARE K, A$, X, Y, MYØERR$, SLICE, FRAME#DECLARE TX, TY, TCLR, IDX, REVØFLAG, CHR, VALUE#DECLARE YY, XX, FIDX#DECLARE CX, CY, CURSORØCLR, SELØCLR#DECLARE CLRØKEY$(15), LN$, FRAMEØCOUNT, CHARØCOUNT, ANIMØCOUNT#DECLARE KK#DECLARE DEFAULTØSLICE(100), CHARØTYPE(100), CHARØIDX(100)#DECLARE CHRØWIDTH(100), CHRØHEIGHT(100)#DECLARE BBØTLX(100,10), BBØTLY(100,10), BBØBRX(100,10), BBØBRY(100,10)#DECLARE BBØCNT(100)'-------.DEFINES'-------#DEFINE À≈ŸØ≈”√¡–≈ = CHR$(27)#DEFINE À≈ŸØ’– = "ë"#DEFINE À≈ŸØƒœ◊Œ = ""#DEFINE À≈ŸØÃ≈∆‘ = "ù"#DEFINE À≈ŸØ“…«»‘ = ""#DEFINE À≈ŸØ∆1 = "Ö"#DEFINE À≈ŸØ∆3 = "Ü"#DEFINE À≈ŸØ∆4 = "ä"#DEFINE À≈ŸØ∆5 = "á"#DEFINE À≈ŸØ∆7 = "à"#DEFINE À≈ŸØ∆8 = "å"#DEFINE À≈ŸØ≈”√ = CHR$(27)#DEFINE À≈ŸØ“≈÷ØœŒ = ""#DEFINE À≈ŸØ“≈÷Øœ∆∆ = "í"#DEFINE À≈ŸØ“≈‘’“Œ = CHR$(13)#DEFINE À≈ŸØÕ≈«¡Ø— = "´"#DEFINE À≈ŸØÕ≈«¡Ø√ = "º"#DEFINE À≈ŸØÕ≈«¡Ø÷ = "æ"#DEFINE À≈ŸØƒ≈Ã = ""#DEFINE À≈ŸØ√Ã“ = "ì"#DEFINE ◊…ƒ‘» = 200#DEFINE œ–Ø√œ–Ÿ = 0#DEFINE œ–ØÕ…ÿ  = 1#DEFINE œ–Ø”◊¡– = 2#DEFINE œ–Ø∆…ÃÃ = 3TRAP RUNSTOPØTRAPPER'----.MAIN'----  GOSUB INIT  GOSUB CLRSCREEN  GOSUB DRAWØPALETTEØSLICE  GOSUB DRAWØFRAME  GOSUB DRAWØFRAMEØCONTENTS  ' GOSUB CLEARØFRAMEØCHARS  GOSUB DRAWØFRAMEØCHARS  GOSUB GETØINPUT  GOTO CLEANUP  END'---------.GETØINPUT'---------  DO WHILE 1    GOSUB DRAWØCURSOR    GET A$    IF A$ = "<" THEN SLICE = MOD(SLICE + 16 - 1, 16) : GOSUB DRAWØPALETTEØSLICE    IF A$ = ">" THEN SLICE = MOD(SLICE + 1, 16) : GOSUB DRAWØPALETTEØSLICE    IF A$ = À≈ŸØ“…«»‘ THEN BEGIN      CX = CX + 1      IF CX = CHRØWIDTH(FIDX) * 8 THEN BEGIN        CX = CHRØWIDTH(FIDX) * 8 - 1        IF CY < (CHRØHEIGHT(FIDX) * 8 - 1) THEN CY = CY + 1 : CX = 0      BEND    BEND    IF A$ = À≈ŸØÃ≈∆‘ THEN BEGIN      CX = CX - 1      IF CX = -1 THEN BEGIN        CX = 0        IF CY > 0 THEN CY = CY - 1 : CX = CHRØWIDTH(FIDX) * 8 - 1      BEND    BEND    IF A$ = À≈ŸØ’– AND CY > 0 THEN CY = CY - 1    IF A$ = À≈ŸØƒœ◊Œ AND CY < (CHRØHEIGHT(FIDX) * 8 - 1) THEN CY = CY + 1    FOR K = 0 TO 15      IF A$ = CLRØKEY$(K) THEN BEGIN        SELØCLR = SLICE * 16 + K        POKE $FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1, SELØCLR        X = MOD(CX, 8)        Y = MOD(CY, 8)        XX = INT(CX / 8)        YY = INT(CY / 8)        POKE CHARØIDX(FIDX) * $40 + $40 * CHRØHEIGHT(FIDX) * XX + $40 * YY + Y * 8 + X, SELØCLR      BEND    NEXT K    IF A$ = " " OR A$ = À≈ŸØƒ≈Ã THEN BEGIN        POKE $FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1, 12        X = MOD(CX, 8)        Y = MOD(CY, 8)        XX = INT(CX / 8)        YY = INT(CY / 8)        POKE CHARØIDX(FIDX) * $40 + $40 * CHRØHEIGHT(FIDX) * XX + $40 * YY + Y * 8 + X, $00    BEND    ' MEGA-Q = EXIT    IF A$ = À≈ŸØÕ≈«¡Ø— THEN BEGIN      TCLR = 0 : TX = 30 : TY = 3 : A$ = "QUIT: ARE YOU SURE? (Y/N)"      GOSUB DRAWØTEXT      GET KEY A$      IF A$="Y" THEN KEY ON : GOTO CLEANUP : ELSE BEGIN        TCLR = 0 : TX = 30 : TY = 3 : A$ = "                         "        GOSUB DRAWØTEXT      BEND    BEND    IF A$ = À≈ŸØ∆1 THEN GOSUB LOADØDATA    IF A$ = À≈ŸØ∆3 THEN GOSUB SAVEØDATA    IF A$ = À≈ŸØ√Ã“ THEN GOSUB PROMPTØCLEAR    CURSORØCLR = MOD(CURSORØCLR + 1, 16)  LOOP  RETURN'------------.PROMPTØCLEAR'------------  TCLR = 0 : TX = 30 : TY = 3 : A$ = "CLEAR: ARE YOU SURE? (Y/N)"  GOSUB DRAWØTEXT  GET KEY A$  IF A$="Y" THEN BEGIN    KEY ON    GOSUB CLEARØFRAMEØCHARS    GOSUB DRAWØFRAMEØCONTENTS  BEND    TCLR = 0 : TX = 30 : TY = 3 : A$ = "                            "  GOSUB DRAWØTEXT  RETURN'---------.LOADØDATA'---------  TCLR = 0 : TX = 30 : TY = 3 : A$ = "LOAD NAME: "  GOSUB DRAWØTEXT  TCLR = 0 : TX = 41 : TY = 3  GOSUB SEAMØINPUT  TX = 30 : A$ = "                               "  GOSUB DRAWØTEXT  CHARØCOUNT = 0  IF LEN(LN$) > 0 THEN BEGIN    DOPEN #2,(LN$),R,U8    IF DS THEN TCLR = 2 : A$ = "DISK ERROR" : GOSUB DRAWØTEXT : RETURN    GET#2, FRAMEØCOUNT    FOR K = 0 TO FRAMEØCOUNT - 1      GET#2, XX : CHARØTYPE(K) = XX AND 255      GET#2, XX : DEFAULTØSLICE(K) = XX AND 255      GET#2, XX : CHRØWIDTH(K) = XX AND 255      GET#2, XX : CHRØHEIGHT(K) = XX AND 255      GET#2, XX, YY      CHARØIDX(K) = (XX AND 255) + (YY AND 255) * 256      GET#2, XX : BBØCNT(K) = XX AND 255      IF BBØCNT(K) > 0 THEN BEGIN        FOR KK = 0 TO BBØCNT(K) - 1          GET#2, XX, YY : BBØTLX(K,KK) = XX AND 255 : BBØTLY(K,KK) = YY AND 255          GET#2, XX, YY : BBØBRX(K,KK) = XX AND 255 : BBØBRY(K,KK) = YY AND 255        NEXT KK      BEND      CHARØCOUNT = CHARØCOUNT + CHRØWIDTH(K) * CHRØHEIGHT(K)    NEXT K    ' TODO : ADD ANIMATION DETAILS HERE    GET#2, XX : ANIMØCOUNT = XX AND 255    IF ANIMØCOUNT > 0 THEN BEGIN      FOR K = 0 TO ANIMØCOUNT - 1        ' LOAD NUMBER OF FRAMES IN ANIM        ' LOAD LIST OF FRAME INDICES      NEXT K    BEND    FOR K = 0 TO CHARØCOUNT * $40      GET#2, XX      POKE CHARØIDX(0) * $40 + K, XX AND 255    NEXT K    DCLOSE #2    GOSUB DRAWØFRAMEØCONTENTS  BEND  RETURN'---------.SAVEØDATA'---------  TCLR = 0 : TX = 30 : TY = 3 : A$ = "SAVE NAME: "  GOSUB DRAWØTEXT  TCLR = 0 : TX = 41 : TY = 3  GOSUB SEAMØINPUT  TX = 30 : A$ = "                               "  GOSUB DRAWØTEXT  CHARØCOUNT = 0  IF LEN(LN$) > 0 THEN BEGIN    DELETE (LN$)    DOPEN #2,(LN$),W,U8    PRINT #2, CHR$(FRAMEØCOUNT);        FOR K = 0 TO FRAMEØCOUNT - 1      PRINT #2, CHR$(CHARØTYPE(K));     ' CHAR-TYPE = FCM / NCM      PRINT #2, CHR$(DEFAULTØSLICE(K));      PRINT #2, CHR$(CHRØWIDTH(K));      PRINT #2, CHR$(CHRØHEIGHT(K));      PRINT #2, CHR$(CHARØIDX(K) AND $FF);      PRINT #2, CHR$(CHARØIDX(K) >> 8);                PRINT #2, CHR$(BBØCNT(K));      IF BBØCNT(K) > 0 THEN BEGIN        FOR KK = 0 TO BBØCNT(0) - 1          PRINT #2, CHR$(BBØTLX(K, KK));CHR$(BBØTLY(K, KK));          PRINT #2, CHR$(BBØBRX(K, KK));CHR$(BBØBRY(K, KK));        NEXT KK      BEND      CHARØCOUNT = CHARØCOUNT + CHRØWIDTH(K) * CHRØHEIGHT(K)    NEXT K    ' TODO : ADD ANIMATION DETAILS HERE    PRINT #2, CHR$(ANIMØCOUNT);    IF ANIMØCOUNT > 0 THEN BEGIN      FOR K = 0 TO ANIMØCOUNT - 1        ' SAVE NUMBER OF FRAMES IN ANIM        ' SAVE LIST OF FRAME INDICES      NEXT K    BEND    FOR K = 0 TO CHARØCOUNT * $40      PRINT #2, CHR$(PEEK(CHARØIDX(0) * $40 + K));    NEXT K    DCLOSE #2      BEND  RETURN'----------.SEAMØINPUT'----------  LN$ = ""  DO WHILE 1    A$ = LN$ + À≈ŸØ“≈÷ØœŒ + " " + À≈ŸØ“≈÷Øœ∆∆ + " "    GOSUB DRAWØTEXT    GET KEY A$    IF (A$ >= "A" AND A$ <= "Z") OR (A$ >= "0" AND A$ <= "9") OR A$="." THEN BEGIN      LN$ = LN$ + A$    BEND    IF A$ = À≈ŸØƒ≈Ã THEN BEGIN      IF LEN(LN$) > 0 THEN LN$ = LEFT$(LN$, LEN(LN$) - 1)    BEND    IF A$ = À≈ŸØ“≈‘’“Œ THEN EXIT  LOOP  RETURN'-----------.DRAWØCURSOR'-----------  FOR Y = 0 TO CHRØHEIGHT(FIDX) * 8 - 1    K = CX * 8    IF CY <> Y THEN K = 80 * 8    ' PREPARE «œ‘œÿ CHAR    POKE $FF80000 + (Y + 2) * ◊…ƒ‘» + 160, %10010000  ' GOTOX BIT + TRANSP FLAG    WPOKE $40800 + (Y + 2) * ◊…ƒ‘» + 160, K    ' PREPARE CURSOR CHAR    WPOKE $FF80002 + (Y + 2) * ◊…ƒ‘» + 160, CURSORØCLR * 256  ' WHITE     WPOKE $40802 + (Y + 2) * ◊…ƒ‘» + 160, $1001    ' PREPARE «œ‘œÿ CHAR (TO OFF-SCREEN)    POKE $FF80004 + (Y + 2) * ◊…ƒ‘» + 160, %10010000  ' GOTOX BIT + TRANSP FLAG    WPOKE $40804 + (Y + 2) * ◊…ƒ‘» + 160, 80 * 8  NEXT Y  RETURN'-------------------.DRAWØFRAMEØCONTENTS'-------------------  FOR XX = 0 TO CHRØWIDTH(FIDX) - 1    FOR YY = 0 TO CHRØHEIGHT(FIDX) - 1      TX = XX * 8      TY = YY * 8 + 2      FOR Y = 0 TO 7        FOR X = 0 TO 7          TCLR = PEEK(CHARØIDX(FIDX) * $40 + $40 * CHRØHEIGHT(FIDX) * XX + $40 * YY + Y * 8 + X)          IF TCLR = 0 THEN TCLR = 12          POKE $FF80000 + (TY + Y) * ◊…ƒ‘» + (TX + X) * 2 + 1, TCLR        NEXT X      NEXT Y    NEXT YY  NEXT XX  RETURN'----------.DRAWØFRAME'----------  TY = 1 : TX = 0 : TCLR = 12  FOR YY = 1 TO CHRØHEIGHT(FIDX)    TY = TY + 1    TX = 0    FOR X = 1 TO CHRØWIDTH(FIDX)      VALUE = $1002 : GOSUB PLOTØCHAR      TX = TX + 1      VALUE = $1003      FOR K = 1 TO 7        GOSUB PLOTØCHAR        TX = TX + 1      NEXT K    NEXT X    VALUE = $1006 : GOSUB PLOTØCHAR    FOR Y = 1 TO 7      TY = TY + 1      TX = 0      FOR X = 1 TO CHRØWIDTH(FIDX)        VALUE = $1004 : GOSUB PLOTØCHAR        TX = TX + 1        VALUE = $1005        FOR K = 1 TO 7          GOSUB PLOTØCHAR          TX = TX + 1        NEXT K      NEXT X      VALUE = $1006 : GOSUB PLOTØCHAR    NEXT Y  NEXT YY  TY = TY + 1  TX = 0  VALUE = $1007  FOR X = 1 TO CHRØWIDTH(FIDX) * 8    GOSUB PLOTØCHAR    TX = TX + 1  NEXT X  RETURN'-----------------.CLEARØFRAMEØCHARS'-----------------  FOR K = 0 TO CHRØWIDTH(FIDX) * CHRØHEIGHT(FIDX) * 64 - 1    POKE CHARØIDX(FIDX) * 64 + K, 0  NEXT K  RETURN'----------------.DRAWØFRAMEØCHARS'----------------  K = CHARØIDX(FIDX)  FOR X = 0 TO CHRØWIDTH(FIDX) - 1    FOR Y = 0 TO CHRØHEIGHT(FIDX) - 1      WPOKE $40800 + (Y + 10) * ◊…ƒ‘» + (X + 30) * 2, K      K = K + 1    NEXT Y  NEXT X  RETURN'---------.PLOTØCHAR'---------  WPOKE $40800 + TY * ◊…ƒ‘» + TX * 2, VALUE  WPOKE $FF80000 + TY * ◊…ƒ‘» + TX * 2, TCLR * 256  RETURN'------------------.DRAWØPALETTEØSLICE'------------------  TCLR = 0 : TX = 0 : TY = 0 : A$ = "SLICE " + RIGHT$(HEX$(SLICE),1) + ": "  GOSUB DRAWØTEXT  FOR K = 0 TO 15    WPOKE $40800 + (9 + K) * 2, $1000    WPOKE $FF80000 + (9 + K) * 2, (SLICE * 16 + K) * 256  NEXT K  TX = 9 : TY = 1 : A$ = "1234QWERASDFZXCV"  GOSUB DRAWØTEXT  RETURN'---------.CLRSCREEN'---------  EDMA œ–Ø∆…ÃÃ, ◊…ƒ‘» * 50, 32, $40800  EDMA œ–Ø∆…ÃÃ, ◊…ƒ‘» * 50, 0, $FF80000  ' CLEAR SCREEN  FOR Y = 0 TO 49   FOR X = 0 TO 79     POKE $40800 + Y * ◊…ƒ‘» + X * 2 + 1, 0   NEXT X  NEXT Y  RETURN'----.INIT'----  BANK 128  KEY OFF  ' HARD-CODING A FEW VALUES THAT WILL BE VARIABLE IN FUTURE  FIDX = 0  CHRØWIDTH(0) = 3  CHRØHEIGHT(0) = 3  CHARØIDX(0) = $1008  FRAMEØCOUNT = 1  ANIMØCOUNT = 0  CLRØKEY$(0) = "1"  CLRØKEY$(1) = "2"  CLRØKEY$(2) = "3"  CLRØKEY$(3) = "4"  CLRØKEY$(4) = "Q"  CLRØKEY$(5) = "W"  CLRØKEY$(6) = "E"  CLRØKEY$(7) = "R"  CLRØKEY$(8) = "A"  CLRØKEY$(9) = "S"  CLRØKEY$(10) = "D"  CLRØKEY$(11) = "F"  CLRØKEY$(12) = "Z"  CLRØKEY$(13) = "X"  CLRØKEY$(14) = "C"  CLRØKEY$(15) = "V"  PRINT "ì";À≈ŸØ≈”√¡–≈;"5";    BKPØD054& = PEEK($D054)  BKPØD058& = PEEK($D058)  BKPØD059& = PEEK($D059)  BKPØD05E& = PEEK($D05E)  ' SET ”≈¡Õ MODE √»“16 + ∆√Ã“»…  SETBIT $D054, 0  SETBIT $D054, 2  WPOKE $D058, ◊…ƒ‘»  POKE $D05E, ◊…ƒ‘» / 2  POKE $D021, 14  POKE $D020, 0  ' $1000 = SOLID FCM CHAR  FOR K = 0 TO 63    POKE $40000 + K, $FF  NEXT K  ' $1001 = BOX CHAR  FOR K = 0 TO 63    IF INT(K / 8) = 0 OR INT(K / 8) = 7 THEN POKE $40040 + K, $FF:GOTO NXT    IF MOD(K, 8) = 0 OR MOD(K, 8) = 7 THEN POKE $40040 + K, $FF:GOTO NXT    POKE $40040 + K, $00.NXT  NEXT K  ' $1002 = TL BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7    VALUE = $FF    IF Y = 0 THEN VALUE = $01    IF X = 0 THEN VALUE = $01    IF Y = 7 AND X = 7 THEN VALUE = $01    POKE $40080 + IDX, VALUE    IDX = IDX + 1    NEXT X  NEXT Y  ' $1003 = T BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $FF      IF Y = 0 THEN VALUE = $01      IF Y = 7 AND X = 7 THEN VALUE = $01      POKE $400C0 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1004 = L BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $FF      IF X = 0 THEN VALUE = $01      IF Y = 7 AND X = 7 THEN VALUE = $01      POKE $40100 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1005 = M BOX  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $FF      IF Y = 7 AND X = 7 THEN VALUE = $01      POKE $40140 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1006 = L LINE  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $00      IF X = 0 THEN VALUE = $01      POKE $40180 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  ' $1007 = T LINE  IDX = 0  FOR Y = 0 TO 7    FOR X = 0 TO 7      VALUE = $00      IF Y = 0 THEN VALUE = $01      POKE $401C0 + IDX, VALUE      IDX = IDX + 1    NEXT X  NEXT Y  RETURN'---------------.RUNSTOPØTRAPPER'---------------  ' IF ER<>30 THEN RESUME  ' IGNORE EVERYTHING EXCEPT RUN/STOP  MYØERR$ = "?" + ERR$(ER) + " IN LINE " + STR$(EL).CLEANUP  PRINT "ì";MYØERR$  TRAP  POKE $D054, BKPØD054&  POKE $D058, BKPØD058&  POKE $D059, BKPØD059&  POKE $D05E, BKPØD05E&  END'---------.DRAWØTEXT'---------  IDX = 0  REVØFLAG = 0  FOR K = 1 TO LEN(A$)    CHR = ASC(MID$(A$,K,1))    IF MID$(A$,K,1) = À≈ŸØ“≈÷ØœŒ THEN REVØFLAG = 1 : GOTO NXTDT    IF MID$(A$,K,1) = À≈ŸØ“≈÷Øœ∆∆ THEN REVØFLAG = 0 : GOTO NXTDT    GOSUB PETSCIIØTOØSCREENCODE    IF REVØFLAG = 1 THEN CHR = CHR OR $80    WPOKE $40800 + TY * ◊…ƒ‘» + (TX + IDX) * 2, CHR    POKE $FF80000 + TY * ◊…ƒ‘» + (TX + IDX) * 2 + 1, TCLR    IDX = IDX + 1.NXTDT  NEXT K  RETURN'---------------------.PETSCIIØTOØSCREENCODE'---------------------  IF CHR>=$00 AND CHR<=$1F THEN CHR = CHR OR $80 : RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF : RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF : RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40 : RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=(CHR AND $7F) OR $40 : RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F : RETURN  RETURN