#OUTPUT "SEAMDRAW"'--------.DECLARES'--------#DECLARE BKPØD054&, BKPØD058&, BKPØD059&, BKPØD05E&#DECLARE K, A$, X, Y, MYØERR$, SLICE, FRAME#DECLARE TX, TY, TCLR, IDX, REVØFLAG, CHR, VALUE#DECLARE YY, XX, FIDX#DECLARE CX, CY, CURSORØCLR, SELØCLR#DECLARE CLRØKEY$(15), LN$, FRAMEØCOUNT, CHARØCOUNT, ANIMØCOUNT#DECLARE KK#DECLARE DEFAULTØSLICE(100), CHARØTYPE(100), CHARØIDX(100)#DECLARE CHRØWIDTH(100), CHRØHEIGHT(100)#DECLARE BBØTLX(100,10), BBØTLY(100,10), BBØBRX(100,10), BBØBRY(100,10)#DECLARE BBØCNT(100)#DECLARE NUMERICØFLAG, RET, TMPØCHRØWIDTH, TMPØCHRØHEIGHT#DECLARE OLDØCHRØWIDTH, OLDØCHRØHEIGHT, OLDØFIDX, TMP, TMP2#DECLARE NEWØCHARØIDX, SKIPØCLEAR#DECLARE RECTØSTATE, RECTØX1%, RECTØY1%, RECTØX2%, RECTØY2%, DR#DECLARE APTRØLO, APTRØHI#DECLARE PANEØX%, PANEØY%, PANEØWIDTH%, PANEØHEIGHT%, PANEØTITLE%#DECLARE SELØIDX%, STATE, ORIGØCX, ORIGØCY, DRAFTØFLAG#DECLARE BKPØCX, BKPØCY, BKPØCLR, COPYØIDX#DECLARE MATCHØCLR, BKPØCX, BKPØCY, CURRØCLR#DECLARE DEFAULTØRED&(255), DEFAULTØGREEN&(255), DEFAULTØBLUE&(255)#DECLARE FILLØFLAG, DR2'-------.DEFINES'-------#DEFINE À≈ŸØ≈”√¡–≈ = CHR$(27)#DEFINE À≈ŸØ’– = "ë"#DEFINE À≈ŸØƒœ◊Œ = ""#DEFINE À≈ŸØÃ≈∆‘ = "ù"#DEFINE À≈ŸØ“…«»‘ = ""#DEFINE À≈ŸØ∆1 = "Ö"#DEFINE À≈ŸØ∆3 = "Ü"#DEFINE À≈ŸØ∆4 = "ä"#DEFINE À≈ŸØ∆5 = "á"#DEFINE À≈ŸØ∆7 = "à"#DEFINE À≈ŸØ∆8 = "å"#DEFINE À≈ŸØ≈”√ = CHR$(27)#DEFINE À≈ŸØ“≈÷ØœŒ = ""#DEFINE À≈ŸØ“≈÷Øœ∆∆ = "í"#DEFINE À≈ŸØ“≈‘’“Œ = CHR$(13)#DEFINE À≈ŸØÕ≈«¡Ø¡ = "∞"#DEFINE À≈ŸØÕ≈«¡Ø— = "´"#DEFINE À≈ŸØÕ≈«¡Ø√ = "º"#DEFINE À≈ŸØÕ≈«¡Ø÷ = "æ"#DEFINE À≈ŸØÕ≈«¡Øƒ = "¨"#DEFINE À≈ŸØÕ≈«¡Ø¬ = "ø"#DEFINE À≈ŸØÕ≈«¡Ø“ = "≤"#DEFINE À≈ŸØÕ≈«¡Ø∆ = "ª"#DEFINE À≈ŸØÕ≈«¡Ø– = "Ø"#DEFINE À≈ŸØƒ≈Ã = ""#DEFINE À≈ŸØ√Ã“ = "ì"#DEFINE ◊…ƒ‘» = 300#DEFINE œ–Ø√œ–Ÿ = 0#DEFINE œ–ØÕ…ÿ  = 1#DEFINE œ–Ø”◊¡– = 2#DEFINE œ–Ø∆…ÃÃ = 3#DEFINE ”‘¡‘≈Øƒ≈∆¡’Ã‘ = 0#DEFINE ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ = 1#DEFINE ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ2 = 2#DEFINE ”‘¡‘≈Ø“≈√‘ = 3TRAP RUNSTOPØTRAPPER'----.MAIN'----  GOSUB INIT  GOSUB CLEARØFRAMEØCHARS  GOSUB REDRAWØSCREEN  GOSUB GETØINPUT  GOTO CLEANUP  END'---------.GETØINPUT'---------  DO WHILE 1    GOSUB DRAWØCURSOR    GET A$    IF A$ = "<" THEN SLICE = MOD(SLICE + 16 - 1, 16) : GOSUB DRAWØPALETTEØSLICE    IF A$ = ">" THEN SLICE = MOD(SLICE + 1, 16) : GOSUB DRAWØPALETTEØSLICE    IF A$ = À≈ŸØ“…«»‘ THEN BEGIN      CX = CX + 1      IF CX = CHRØWIDTH(FIDX) * 8 THEN BEGIN        CX = CHRØWIDTH(FIDX) * 8 - 1        IF CY < (CHRØHEIGHT(FIDX) * 8 - 1) THEN CY = CY + 1 : CX = 0      BEND    BEND    IF A$ = À≈ŸØÃ≈∆‘ THEN BEGIN      CX = CX - 1      IF CX = -1 THEN BEGIN        CX = 0        IF CY > 0 THEN CY = CY - 1 : CX = CHRØWIDTH(FIDX) * 8 - 1      BEND    BEND    IF A$ = À≈ŸØ’– AND CY > 0 THEN CY = CY - 1    IF A$ = À≈ŸØƒœ◊Œ AND CY < (CHRØHEIGHT(FIDX) * 8 - 1) THEN CY = CY + 1    IF STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘ THEN BEGIN      GOSUB CHECKØCOLOURØKEYS      IF A$ = À≈ŸØ∆1 THEN GOSUB LOADØDATA      IF A$ = À≈ŸØ∆3 THEN GOSUB SAVEØDATA      IF A$ = "," AND FIDX > 0 THEN BEGIN        FIDX = FIDX - 1        GOSUB REDRAWØSCREEN      BEND      IF A$ = "." AND FIDX < FRAMEØCOUNT - 1 THEN BEGIN        FIDX = FIDX + 1        GOSUB REDRAWØSCREEN      BEND      IF A$ = À≈ŸØÕ≈«¡Ø¡ THEN GOSUB PROMPTØADDØFRAME      IF A$ = À≈ŸØ√Ã“ THEN GOSUB PROMPTØCLEAR      IF A$ = À≈ŸØÕ≈«¡Øƒ THEN GOSUB DUPLICATE      IF A$ = À≈ŸØÕ≈«¡Ø¬ THEN GOSUB PROMPTØBOUNDINGØBOX      IF A$ = À≈ŸØÕ≈«¡Ø“ THEN GOSUB DOØRECTANGLE      IF A$ = À≈ŸØÕ≈«¡Ø∆ THEN GOSUB DOØFILL      IF A$ = À≈ŸØÕ≈«¡Ø– THEN GOSUB HANDLEØCOLOURØCYCLING    BEND    ' - - - - - - -    IF STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ OR STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ2 THEN BEGIN      IF STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ2 THEN BEGIN        IF A$ = À≈ŸØ’– OR A$ = À≈ŸØƒœ◊Œ OR _           A$ = À≈ŸØÃ≈∆‘ OR A$ = À≈ŸØ“…«»‘ THEN BEGIN          DRAFTØFLAG = 1          GOSUB REDRAWØRECTØATØCURSORØPOS        BEND      BEND      IF A$ = À≈ŸØ“≈‘’“Œ THEN BEGIN        DRAFTØFLAG = 1        GOSUB UPDATEØBOUNDINGØBOXØCOORD      BEND      IF A$ = À≈ŸØ≈”√¡–≈ OR A$ = À≈ŸØÕ≈«¡Ø— THEN BEGIN        GOSUB DRAWØFRAMEØCONTENTS        STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘      BEND    BEND    ' - - - - - - -    IF STATE = ”‘¡‘≈Ø“≈√‘ THEN BEGIN      IF A$ = À≈ŸØÕ≈«¡Ø“ OR A$ = À≈ŸØ“≈‘’“Œ THEN GOSUB DOØRECTANGLE      IF A$ = À≈ŸØ’– OR A$ = À≈ŸØƒœ◊Œ OR _         A$ = À≈ŸØÃ≈∆‘ OR A$ = À≈ŸØ“…«»‘ THEN BEGIN        DRAFTØFLAG = 1        GOSUB REDRAWØRECTØATØCURSORØPOS      BEND      IF A$ = "F" THEN BEGIN        IF FILLØFLAG = 0 THEN FILLØFLAG = 1: ELSE FILLØFLAG = 0        DRAFTØFLAG = 1        GOSUB REDRAWØRECTØATØCURSORØPOS      BEND      IF A$ = À≈ŸØ≈”√¡–≈ THEN BEGIN        GOSUB REDRAWØPRESERVEDØDATA        STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘      BEND    BEND    ' - - - - - - -    ' MEGA-Q = EXIT    IF A$ = À≈ŸØÕ≈«¡Ø— THEN GOSUB HANDLEØQUIT    CURSORØCLR = MOD(CURSORØCLR + 1, 16)  LOOP  RETURN'-------------------------.UPDATEØBOUNDINGØBOXØCOORD'-------------------------  IF STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ THEN BEGIN    RECTØX1% = CX    RECTØY1% = CY    RECTØX2% = CX    RECTØY1% = CY    GOSUB REDRAWØRECTØATØCURSORØPOS    STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ2    RETURN  BEND  IF STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ2 THEN BEGIN    BBØTLX(FIDX, SELØIDX%) = RECTØX1%    BBØTLY(FIDX, SELØIDX%) = RECTØY1%    BBØBRX(FIDX, SELØIDX%) = CX    BBØBRY(FIDX, SELØIDX%) = CY    STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘    SELØCLR = BKPØCLR    STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘    GOSUB DRAWØFRAMEØCONTENTS    GOSUB PROMPTØBOUNDINGØBOX  BEND  RETURN'-----------------.CHECKØCOLOURØKEYS'-----------------  FOR K = 0 TO 15    IF A$ = CLRØKEY$(K) THEN BEGIN      SELØCLR = SLICE * 16 + K      POKE $FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1, SELØCLR      X = MOD(CX, 8)      Y = MOD(CY, 8)      XX = INT(CX / 8)      YY = INT(CY / 8)      POKE CHARØIDX(FIDX) * $40 + $40 * CHRØHEIGHT(FIDX) * XX + $40 * YY + Y * 8 + X, SELØCLR    BEND  NEXT K  IF A$ = " " OR A$ = À≈ŸØƒ≈Ã THEN BEGIN    POKE $FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1, 12    X = MOD(CX, 8)    Y = MOD(CY, 8)    XX = INT(CX / 8)    YY = INT(CY / 8)    POKE CHARØIDX(FIDX) * $40 + $40 * CHRØHEIGHT(FIDX) * XX + $40 * YY + Y * 8 + X, $00  BEND  RETURN'-----------.HANDLEØQUIT'-----------  TCLR = 0 : A$ = "QUIT: ARE YOU SURE? (Y/N)"  PANEØWIDTH% = LEN(A$) + 4  PANEØHEIGHT% = 5  GOSUB SHOWØCENTREDØPANE  GET KEY A$  IF A$="Y" THEN KEY ON : GOTO CLEANUP    GOSUB HIDEØPANE  RETURN'-----------------.SHOWØCENTREDØPANE'-----------------  PANEØX% = (80 - PANEØWIDTH%) / 2  PANEØY% = (50 - PANEØHEIGHT%) / 2  GOSUB DRAWØPANE  TCLR = 0 : TX = PANEØX% + 2 : TY = PANEØY% + 2  GOSUB DRAWØTEXT  RETURN'---------.DRAWØPANE'---------  BANK 0  POKE $7E10, PANEØX%  POKE $7E11, PANEØY%  POKE $7E12, PANEØWIDTH%  POKE $7E13, PANEØHEIGHT%^^  SYS TO $7F09, I0  BANK 128  RETURN'---------.HIDEØPANE'---------  BANK 0  POKE $7E10, PANEØX%  POKE $7E11, PANEØY%  POKE $7E12, PANEØWIDTH%  POKE $7E13, PANEØHEIGHT%^^  SYS TO $7F0C, I0  BANK 128  RETURN'---------------------.REDRAWØPRESERVEDØDATA'---------------------  BANK 0^^  SYS TO $7F0C, I0  BANK 128  RETURN'-------.DOØFILL'-------  ORIGØCX = CX  ORIGØCY = CY  BKPØCX = CX  BKPØCY = CY    MATCHØCLR = PEEK($FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1)  GOSUB TRAVELØRIGHTØANDØLEFT  GOSUB TRAVELØUP  GOSUB TRAVELØDOWN    CX = ORIGØCX  CY = ORIGØCY  RETURN.TRAVELØDOWN'-----------  BKPØCX = ORIGØCX  BKPØCY = ORIGØCY  DO    BKPØCY = BKPØCY + 1    IF BKPØCY = CHRØHEIGHT(FIDX) * 8 THEN EXIT    CURRØCLR = PEEK($FF80000 + (BKPØCY + 2) * ◊…ƒ‘» + BKPØCX * 2 + 1)    K = 0    IF CURRØCLR = MATCHØCLR THEN K = 1 : GOSUB TRAVELØRIGHTØANDØLEFT  LOOP WHILE K = 1  RETURN.TRAVELØUP'---------  BKPØCX = ORIGØCX  BKPØCY = ORIGØCY  DO    BKPØCY = BKPØCY - 1    IF BKPØCY < 0 THEN EXIT    CURRØCLR = PEEK($FF80000 + (BKPØCY + 2) * ◊…ƒ‘» + BKPØCX * 2 + 1)    K = 0    IF CURRØCLR = MATCHØCLR THEN K = 1 : GOSUB TRAVELØRIGHTØANDØLEFT  LOOP WHILE K = 1  RETURN.TRAVELØRIGHTØANDØLEFT'---------------------  CX = BKPØCX  CY = BKPØCY  GOSUB TRAVELØRIGHT  CX = BKPØCX  CY = BKPØCY  GOSUB TRAVELØLEFT  RETURN.TRAVELØRIGHT'------------  DO    GOSUB PLOTØPIXEL    CX = CX + 1    IF CX = CHRØWIDTH(FIDX) * 8 THEN EXIT    CURRØCLR = PEEK($FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1)    IF CURRØCLR = MATCHØCLR THEN GOSUB PLOTØPIXEL  LOOP WHILE CURRØCLR = MATCHØCLR  RETURN.TRAVELØLEFT'-----------  DO    GOSUB PLOTØPIXEL    CX = CX - 1    IF CX = -1 THEN EXIT    CURRØCLR = PEEK($FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1)    IF CURRØCLR = MATCHØCLR THEN GOSUB PLOTØPIXEL  LOOP WHILE CURRØCLR = MATCHØCLR  RETURN'------------.DOØRECTANGLE'------------  STATE = ”‘¡‘≈Ø“≈√‘  A$ = ""  IF RECTØSTATE = 0 THEN BEGIN    RECTØX1% = CX    RECTØY1% = CY    RECTØSTATE = 1    GOSUB PRESERVEØFRAMEØCONTENTS  BEND : ELSE BEGIN    DRAFTØFLAG = 0    GOSUB REDRAWØRECTØATØCURSORØPOS    RECTØSTATE = 0    STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘  BEND  RETURN'-------------------------.REDRAWØRECTØATØCURSORØPOS'-------------------------  RECTØX2% = CX  RECTØY2% = CY  GOSUB REDRAWØPRESERVEDØDATA  GOSUB DRAWØRECT  RETURN'---------.DRAWØRECT'---------  DR = 1  DR2 = 1  ORIGØCX = CX  ORIGØCY = CY  IF FILLØFLAG = 1 THEN BEGIN    IF RECTØY1% > RECTØY2% THEN DR = -1    FOR CY = RECTØY1% TO RECTØY2% STEP DR      IF RECTØX1% > RECTØX2% THEN DR2 = -1        FOR CX = RECTØX1% TO RECTØX2% STEP DR2          GOSUB PLOTØPIXEL        NEXT CX    NEXT CY  BEND : ELSE BEGIN    ' NO FILL, JUST BORDER    IF RECTØX1% > RECTØX2% THEN DR = -1    FOR CX = RECTØX1% TO RECTØX2% STEP DR      CY = RECTØY1%      GOSUB PLOTØPIXEL      CY = RECTØY2%      GOSUB PLOTØPIXEL    NEXT CX    DR = 1    IF RECTØY1% > RECTØY2% THEN DR = -1    FOR CY = RECTØY1% TO RECTØY2% STEP DR      CX = RECTØX1%      GOSUB PLOTØPIXEL      CX = RECTØX2%      GOSUB PLOTØPIXEL    NEXT CY  BEND  CX = ORIGØCX  CY = ORIGØCY  RETURN'-----------------------.PRESERVEØFRAMEØCONTENTS'-----------------------  BANK 0  POKE $7E10, 0  ' PANEØX  POKE $7E11, 2  ' PANEØY  POKE $7E12, CHRØWIDTH(FIDX) * 8  ' PANEØWIDTH  POKE $7E13, CHRØHEIGHT(FIDX) * 8  ' PANEØHEIGHT  SYS $7F1B  BANK 128    RETURN'----------.PLOTØPIXEL'----------  POKE $FF80000 + (CY + 2) * ◊…ƒ‘» + CX * 2 + 1, SELØCLR  IF DRAFTØFLAG = 1 THEN RETURN  ' WE HAVEN'T FINALISED  X = MOD(CX, 8)  Y = MOD(CY, 8)  XX = INT(CX / 8)  YY = INT(CY / 8)  POKE CHARØIDX(FIDX) * $40 + $40 * CHRØHEIGHT(FIDX) * XX + $40 * YY + Y * 8 + X, SELØCLR  RETURN'-------------------.PROMPTØBOUNDINGØBOX'-------------------  IF SELØIDX% >= BBØCNT(FIDX) THEN SELØIDX% = 0  GOSUB DRAWØBOUNDINGØBOXES  PANEØWIDTH% = 30  PANEØHEIGHT% = 30  PANEØX% = (80 - PANEØWIDTH%) / 2 + 10  PANEØY% = (50 - PANEØHEIGHT%) / 2 + 5  GOSUB DRAWØPANE  STATE = ”‘¡‘≈Øƒ≈∆¡’Ã‘  GOSUB DRAWØBOUNDINGØBOXØDETAILS  DO WHILE 1    GET KEY A$    IF A$ = "A" THEN GOSUB ADDØBOUNDINGØBOX    IF A$ = "D" THEN GOSUB DELETEØBOUNDINGØBOX    IF A$ = À≈ŸØƒœ◊Œ AND BBØCNT(FIDX) > 0 THEN BEGIN      SELØIDX% = MOD(SELØIDX% + 1, BBØCNT(FIDX))      GOSUB CLEARØPANE      GOSUB DRAWØBOUNDINGØBOXES      GOSUB DRAWØBOUNDINGØBOXØDETAILS    BEND    IF A$ = À≈ŸØ’– AND BBØCNT(FIDX) > 0 THEN BEGIN      SELØIDX% = MOD(SELØIDX% + BBØCNT(FIDX) - 1, BBØCNT(FIDX))      GOSUB CLEARØPANE      GOSUB DRAWØBOUNDINGØBOXES      GOSUB DRAWØBOUNDINGØBOXØDETAILS    BEND    IF (A$ = "E" OR A$ = À≈ŸØ“≈‘’“Œ) AND BBØCNT(FIDX) > 0 THEN BEGIN      A$ = ""      CX = BBØTLX(FIDX, SELØIDX%)      CY = BBØTLY(FIDX, SELØIDX%)      STATE = ”‘¡‘≈Ø¬œ’Œƒ…Œ«Ø¬œÿ      GOSUB HIDEØPANE      GOSUB PRESERVEØFRAMEØCONTENTS      BKPØCLR = SELØCLR      SELØCLR = 1      A$ = ""      EXIT    BEND    IF A$ = À≈ŸØÕ≈«¡Ø√ THEN COPYØIDX = FIDX    IF A$ = À≈ŸØÕ≈«¡Ø÷ THEN GOSUB PASTEØBOUNDINGØBOXES    IF A$ = "," AND FIDX > 0 THEN BEGIN      FIDX = FIDX - 1      GOSUB HIDEØPANE      GOSUB REDRAWØSCREEN      GOSUB DRAWØBOUNDINGØBOXES      GOSUB DRAWØPANE      GOSUB DRAWØBOUNDINGØBOXØDETAILS    BEND    IF A$ = "." AND FIDX < FRAMEØCOUNT - 1 THEN BEGIN      FIDX = FIDX + 1      GOSUB HIDEØPANE      GOSUB REDRAWØSCREEN      GOSUB DRAWØBOUNDINGØBOXES      GOSUB DRAWØPANE      GOSUB DRAWØBOUNDINGØBOXØDETAILS    BEND    IF A$ = À≈ŸØ≈”√¡–≈ OR A$ = À≈ŸØÕ≈«¡Ø— THEN BEGIN      A$ = ""      GOSUB HIDEØPANE      GOSUB DRAWØFRAMEØCONTENTS      EXIT  ' USING EXIT WITHIN IF-BEGIN-BEND SEEMS TO CAUSE WEIRD JUMPS    BEND  LOOP  RETURN'--------------------.PASTEØBOUNDINGØBOXES'--------------------  BBØCNT(FIDX) = BBØCNT(COPYØIDX)  IF BBØCNT(FIDX) > 0 THEN BEGIN    FOR K = 0 TO BBØCNT(FIDX) - 1      BBØTLX(FIDX, K) = BBØTLX(COPYØIDX, K)      BBØTLY(FIDX, K) = BBØTLY(COPYØIDX, K)      BBØBRX(FIDX, K) = BBØBRX(COPYØIDX, K)      BBØBRY(FIDX, K) = BBØBRY(COPYØIDX, K)    NEXT K  BEND  GOSUB CLEARØPANE  GOSUB DRAWØFRAMEØCONTENTS  GOSUB DRAWØBOUNDINGØBOXES  GOSUB DRAWØBOUNDINGØBOXØDETAILS  RETURN'-------------------.DRAWØBOUNDINGØBOXES'-------------------  IF BBØCNT(FIDX) = 0 THEN RETURN  BKPØCX = CX  BKPØCY = CY  IDX = 0  BKPØCLR = SELØCLR  FOR K = 0 TO BBØCNT(FIDX) - 1    RECTØX1% = BBØTLX(FIDX, IDX)    RECTØY1% = BBØTLY(FIDX, IDX)    RECTØX2% = BBØBRX(FIDX, IDX)    RECTØY2% = BBØBRY(FIDX, IDX)    SELØCLR = 3    IF IDX = SELØIDX% THEN SELØCLR = 2    DRAFTØFLAG = 1    GOSUB DRAWØRECT    IDX = IDX + 1  NEXT K  CX = BKPØCX  CY = BKPØCY  SELØCLR = BKPØCLR  RETURN'-------------------------.DRAWØBOUNDINGØBOXØDETAILS'-------------------------  TX = PANEØX% + 2 : TY = PANEØY% + 2 : TCLR = 0  A$ = "BOUNDING BOX DETAILS:"  GOSUB DRAWØTEXT  TY = TY + 1 : A$ = "(A)DD  (D)ELETE  (E)DIT"  GOSUB DRAWØTEXT  IDX = 0  DO WHILE IDX < BBØCNT(FIDX)    TY = TY + 2    A$ = ""    IF IDX = SELØIDX% THEN A$ = À≈ŸØ“≈÷ØœŒ    A$ = A$ + "(" + MID$(STR$(BBØTLX(FIDX, IDX)), 2)    A$ = A$ + "," + STR$(BBØTLY(FIDX, IDX)) + ") - ("    A$ = A$ + MID$(STR$(BBØBRX(FIDX, IDX)), 2)    A$ = A$ + "," + STR$(BBØBRY(FIDX, IDX)) + ")"    GOSUB DRAWØTEXT    IDX = IDX + 1  LOOP  RETURN'----------------.ADDØBOUNDINGØBOX'----------------  BBØCNT(FIDX) = BBØCNT(FIDX) + 1  SELØIDX% = BBØCNT(FIDX) - 1  GOSUB CLEARØPANE  GOSUB DRAWØBOUNDINGØBOXØDETAILS  RETURN'-------------------.DELETEØBOUNDINGØBOX'-------------------  IF SELØIDX% < BBØCNT(FIDX) - 1 THEN BEGIN    FOR K = SELØIDX% TO BBØCNT(FIDX) - 2      BBØTLX(FIDX, K) = BBØTLX(FIDX, K + 1)      BBØTLY(FIDX, K) = BBØTLY(FIDX, K + 1)      BBØBRX(FIDX, K) = BBØBRX(FIDX, K + 1)      BBØBRY(FIDX, K) = BBØBRY(FIDX, K + 1)    NEXT K  BEND  BBØCNT(FIDX) = BBØCNT(FIDX) - 1  IF SELØIDX% = BBØCNT(FIDX) AND SELØIDX% > 0 THEN SELØIDX% = BBØCNT(FIDX) - 1  GOSUB CLEARØPANE  GOSUB DRAWØFRAMEØCONTENTS  GOSUB DRAWØBOUNDINGØBOXØDETAILS  RETURN'----------.CLEARØPANE'----------  ' CLEARØPANE  BANK 0 : SYS $7F12 : BANK 128  RETURN'---------.DUPLICATE'---------  TMPØCHRØWIDTH = CHRØWIDTH(FIDX)  TMPØCHRØHEIGHT = CHRØHEIGHT(FIDX)  OLDØFIDX = FIDX  TMP = FRAMEØCOUNT - 1  NEWØCHARØIDX = CHARØIDX(TMP) + CHRØWIDTH(TMP) * CHRØHEIGHT(TMP)  TMP = CHRØWIDTH(FIDX) * CHRØHEIGHT(FIDX) * $40 - 1  TMP2 = CHARØIDX(FIDX) * $40  FOR K = 0 TO TMP    POKE NEWØCHARØIDX * $40 + K, PEEK(TMP2 + K)  NEXT K  SKIPØCLEAR = 1  GOSUB ADDØFRAME  RETURN'-------------.REDRAWØSCREEN'-------------  IF OLDØCHRØWIDTH <> CHRØWIDTH(FIDX) OR OLDØCHRØHEIGHT <> CHRØHEIGHT(FIDX) THEN BEGIN    GOSUB CLRSCREEN    GOSUB DRAWØPALETTEØSLICE    GOSUB DRAWØFRAME    OLDØCHRØWIDTH = CHRØWIDTH(FIDX)    OLDØCHRØHEIGHT = CHRØHEIGHT(FIDX)  BEND  GOSUB DRAWØFRAMEØCONTENTS  GOSUB DRAWØFRAMEØCHARS  RETURN'------------.PROMPTØCLEAR'------------  TCLR = 0 : A$ = "CLEAR: ARE YOU SURE? (Y/N)"  PANEØWIDTH% = LEN(A$) + 4  PANEØHEIGHT% = 5  GOSUB SHOWØCENTREDØPANE  GET KEY A$  IF A$="Y" THEN BEGIN    KEY ON    GOSUB CLEARØFRAMEØCHARS    GOSUB DRAWØFRAMEØCONTENTS  BEND    GOSUB HIDEØPANE  RETURN'----------------.PROMPTØADDØFRAME'----------------  PANEØWIDTH% = 30  PANEØHEIGHT% = 7  GOSUB SHOWØCENTREDØPANE  TCLR = 0 : TX = PANEØX% + 2 : TY = PANEØY% + 2  A$ = "ADD FRAME:"  GOSUB DRAWØTEXT  TY = TY + 1  A$ = "  ENTER CHAR-WIDTH: "  GOSUB DRAWØTEXT  TX = PANEØX% + 23 : NUMERICØFLAG = 1 : GOSUB SEAMØINPUT  IF RET = 0 THEN GOSUB HIDEØPANE : RETURN  TMPØCHRØWIDTH = VAL(LN$)  TY = TY + 1  TX = PANEØX% + 2  A$ = "  ENTER CHAR-HEIGHT: "  GOSUB DRAWØTEXT  TX = PANEØX% + 23 : NUMERICØFLAG = 1 : GOSUB SEAMØINPUT  IF RET = 0 THEN GOSUB HIDEØPANE : RETURN  TMPØCHRØHEIGHT = VAL(LN$)  GOSUB HIDEØPANE.ADDØFRAME  ' WE GOT BOTH PARAMS FROM USER, NOW MAKE IT  FIDX = FRAMEØCOUNT  FRAMEØCOUNT = FRAMEØCOUNT + 1  CHRØWIDTH(FIDX) = TMPØCHRØWIDTH  CHRØHEIGHT(FIDX) = TMPØCHRØHEIGHT  CHARØIDX(FIDX) = CHARØIDX(FIDX - 1) + CHRØWIDTH(FIDX-1) * CHRØHEIGHT(FIDX-1)  IF SKIPØCLEAR = 0 THEN BEGIN    GOSUB CLEARØFRAMEØCHARS    SKIPØCLEAR = 0  BEND  GOSUB REDRAWØSCREEN    RETURN'---------.LOADØDATA'---------  PANEØWIDTH% = 30  PANEØHEIGHT% = 5  GOSUB SHOWØCENTREDØPANE  TCLR = 0 : TX = PANEØX% + 2 : TY = PANEØY% + 2 : A$ = "LOAD NAME: "  GOSUB DRAWØTEXT  TCLR = 0 : TX = PANEØX% + 13  GOSUB SEAMØINPUT  GOSUB HIDEØPANE  IF RET = 0 THEN RETURN  CHARØCOUNT = 0  IF LEN(LN$) > 0 THEN BEGIN    DOPEN #2,(LN$),R,U8    IF DS THEN TCLR = 2 : A$ = "DISK ERROR" : GOSUB DRAWØTEXT : RETURN    GET#2, FRAMEØCOUNT    FOR K = 0 TO FRAMEØCOUNT - 1      GET#2, XX : CHARØTYPE(K) = XX AND 255      GET#2, XX : DEFAULTØSLICE(K) = XX AND 255      GET#2, XX : CHRØWIDTH(K) = XX AND 255      GET#2, XX : CHRØHEIGHT(K) = XX AND 255      GET#2, XX, YY      CHARØIDX(K) = (XX AND 255) + (YY AND 255) * 256      GET#2, XX : BBØCNT(K) = XX AND 255      IF BBØCNT(K) > 0 THEN BEGIN        FOR KK = 0 TO BBØCNT(K) - 1          GET#2, XX, YY : BBØTLX(K,KK) = XX AND 255 : BBØTLY(K,KK) = YY AND 255          GET#2, XX, YY : BBØBRX(K,KK) = XX AND 255 : BBØBRY(K,KK) = YY AND 255        NEXT KK      BEND      CHARØCOUNT = CHARØCOUNT + CHRØWIDTH(K) * CHRØHEIGHT(K)    NEXT K    ' TODO : ADD ANIMATION DETAILS HERE    GET#2, XX : ANIMØCOUNT = XX AND 255    IF ANIMØCOUNT > 0 THEN BEGIN      FOR K = 0 TO ANIMØCOUNT - 1        ' LOAD NUMBER OF FRAMES IN ANIM        ' LOAD LIST OF FRAME INDICES      NEXT K    BEND    FOR K = 0 TO CHARØCOUNT * $40      GET#2, XX      POKE CHARØIDX(0) * $40 + K, XX AND 255    NEXT K    DCLOSE #2    GOSUB DRAWØFRAMEØCONTENTS  BEND  RETURN'---------.SAVEØDATA'---------  PANEØWIDTH% = 30  PANEØHEIGHT% = 5  GOSUB SHOWØCENTREDØPANE  TCLR = 0 : TX = PANEØX% + 2 : TY = PANEØY% + 2 : A$ = "SAVE NAME: "  GOSUB DRAWØTEXT  TCLR = 0 : TX = PANEØX% + 13  GOSUB SEAMØINPUT  GOSUB HIDEØPANE  IF RET = 0 THEN RETURN  CHARØCOUNT = 0  IF LEN(LN$) > 0 THEN BEGIN    DELETE (LN$)    DOPEN #2,(LN$),W,U8    PRINT #2, CHR$(FRAMEØCOUNT);        FOR K = 0 TO FRAMEØCOUNT - 1      PRINT #2, CHR$(CHARØTYPE(K));     ' CHAR-TYPE = FCM / NCM      PRINT #2, CHR$(DEFAULTØSLICE(K));      PRINT #2, CHR$(CHRØWIDTH(K));      PRINT #2, CHR$(CHRØHEIGHT(K));      PRINT #2, CHR$(CHARØIDX(K) AND $FF);      PRINT #2, CHR$(CHARØIDX(K) >> 8);                PRINT #2, CHR$(BBØCNT(K));      IF BBØCNT(K) > 0 THEN BEGIN        FOR KK = 0 TO BBØCNT(K) - 1          PRINT #2, CHR$(BBØTLX(K, KK));CHR$(BBØTLY(K, KK));          PRINT #2, CHR$(BBØBRX(K, KK));CHR$(BBØBRY(K, KK));        NEXT KK      BEND      CHARØCOUNT = CHARØCOUNT + CHRØWIDTH(K) * CHRØHEIGHT(K)    NEXT K    ' TODO : ADD ANIMATION DETAILS HERE    PRINT #2, CHR$(ANIMØCOUNT);    IF ANIMØCOUNT > 0 THEN BEGIN      FOR K = 0 TO ANIMØCOUNT - 1        ' SAVE NUMBER OF FRAMES IN ANIM        ' SAVE LIST OF FRAME INDICES      NEXT K    BEND    FOR K = 0 TO CHARØCOUNT * $40      PRINT #2, CHR$(PEEK(CHARØIDX(0) * $40 + K));    NEXT K    DCLOSE #2      BEND  RETURN'----------.SEAMØINPUT'----------  LN$ = ""  DO WHILE 1    A$ = LN$ + À≈ŸØ“≈÷ØœŒ + " " + À≈ŸØ“≈÷Øœ∆∆ + " "    GOSUB DRAWØTEXT    GET KEY A$    IF (A$ >= "A" AND A$ <= "Z" AND NOT NUMERICØFLAG) OR (A$ >= "0" AND A$ <= "9") OR A$="." THEN BEGIN      LN$ = LN$ + A$    BEND    IF A$ = À≈ŸØƒ≈Ã THEN BEGIN      IF LEN(LN$) > 0 THEN LN$ = LEFT$(LN$, LEN(LN$) - 1)    BEND    IF A$ = À≈ŸØ≈”√¡–≈ THEN RET = 0 : EXIT    IF A$ = À≈ŸØ“≈‘’“Œ THEN RET = 1 : EXIT  LOOP  ' REMOVE CURSOR AT END  A$ = LN$ + " "  GOSUB DRAWØTEXT  NUMERICØFLAG = 0  RETURN'-----------.DRAWØCURSOR'-----------  FOR Y = 0 TO CHRØHEIGHT(FIDX) * 8 - 1    K = CX * 8    IF CY <> Y THEN K = 80 * 8    ' PREPARE «œ‘œÿ CHAR    POKE $FF80000 + (Y + 2) * ◊…ƒ‘» + 160, %10010000  ' GOTOX BIT + TRANSP FLAG    WPOKE $40800 + (Y + 2) * ◊…ƒ‘» + 160, K    ' PREPARE CURSOR CHAR    WPOKE $FF80002 + (Y + 2) * ◊…ƒ‘» + 160, CURSORØCLR * 256  ' WHITE     WPOKE $40802 + (Y + 2) * ◊…ƒ‘» + 160, $1001    ' PREPARE «œ‘œÿ CHAR (TO OFF-SCREEN)    POKE $FF80004 + (Y + 2) * ◊…ƒ‘» + 160, %10010000  ' GOTOX BIT + TRANSP FLAG    WPOKE $40804 + (Y + 2) * ◊…ƒ‘» + 160, 80 * 8  NEXT Y  RETURN'-------------------.DRAWØFRAMEØCONTENTS'-------------------  TCLR = 0 : TX = 0 : TY = 1 : A$ = "FRAME#" + MID$(STR$(FIDX), 2)  GOSUB DRAWØTEXT  BANK 0  POKE $7E16, CHRØWIDTH(FIDX)  POKE $7E17, CHRØHEIGHT(FIDX)  WPOKE $7E18, CHARØIDX(FIDX)  SYS $7F15  BANK 128  RETURN'----------.DRAWØFRAME'----------  BANK 0  POKE $7E16, CHRØWIDTH(FIDX)  POKE $7E17, CHRØHEIGHT(FIDX)  SYS $7F18  BANK 128  RETURN'-----------------.CLEARØFRAMEØCHARS'-----------------  FOR K = 0 TO CHRØWIDTH(FIDX) * CHRØHEIGHT(FIDX) * 64 - 1    POKE CHARØIDX(FIDX) * 64 + K, 0  NEXT K  RETURN'----------------.DRAWØFRAMEØCHARS'----------------  TCLR = 0 : TX = 60 : TY = 9  A$ = "CHAR-IDX: $" + RIGHT$(HEX$(CHARØIDX(FIDX)),4)  GOSUB DRAWØTEXT  K = CHARØIDX(FIDX)  FOR X = 0 TO CHRØWIDTH(FIDX) - 1    FOR Y = 0 TO CHRØHEIGHT(FIDX) - 1      WPOKE $40800 + (Y + 10) * ◊…ƒ‘» + (X + 60) * 2, K      K = K + 1    NEXT Y  NEXT X  RETURN'---------.PLOTØCHAR'---------  BANK 0  POKE $7E0D, TX  POKE $7E0E, TY  POKE $7E0F, TCLR  WPOKE $7E14, VALUE^^ SYS TO $7F0F, I0  BANK 128  RETURN  '------------------.DRAWØPALETTEØSLICE'------------------  TCLR = 0 : TX = 0 : TY = 0 : A$ = "SLICE " + RIGHT$(HEX$(SLICE),1) + ": "  GOSUB DRAWØTEXT  FOR K = 0 TO 15    WPOKE $40800 + (9 + K) * 2, $1000    WPOKE $FF80000 + (9 + K) * 2, (SLICE * 16 + K) * 256  NEXT K  TX = 9 : TY = 1 : A$ = "1234QWERASDFZXCV"  GOSUB DRAWØTEXT  RETURN'---------.CLRSCREEN'---------  BANK 0^^ SYS TO $7F06, I0  BANK 128  RETURN'----.INIT'----  BANK 128  KEY OFF  BLOAD "GAME.PAL",P($FFD3100)  BLOAD "CHARS.BIN",P($40000),R  BLOAD "ASMHELPER"  APTRØLO = POINTER(A$) AND $FF  APTRØHI = POINTER(A$) / 256  ' HARD-CODING A FEW VALUES THAT WILL BE VARIABLE IN FUTURE  FIDX = 0  CHRØWIDTH(0) = 3  CHRØHEIGHT(0) = 3  CHARØIDX(0) = $1400  FRAMEØCOUNT = 1  ANIMØCOUNT = 0  GOSUB STOREØDEFAULTØCOLOURS  CLRØKEY$(0) = "1"  CLRØKEY$(1) = "2"  CLRØKEY$(2) = "3"  CLRØKEY$(3) = "4"  CLRØKEY$(4) = "Q"  CLRØKEY$(5) = "W"  CLRØKEY$(6) = "E"  CLRØKEY$(7) = "R"  CLRØKEY$(8) = "A"  CLRØKEY$(9) = "S"  CLRØKEY$(10) = "D"  CLRØKEY$(11) = "F"  CLRØKEY$(12) = "Z"  CLRØKEY$(13) = "X"  CLRØKEY$(14) = "C"  CLRØKEY$(15) = "V"  PRINT "ì";À≈ŸØ≈”√¡–≈;"5";    BKPØD054& = PEEK($D054)  BKPØD058& = PEEK($D058)  BKPØD059& = PEEK($D059)  BKPØD05E& = PEEK($D05E)  ' SET ”≈¡Õ MODE √»“16 + ∆√Ã“»…  SETBIT $D054, 0  SETBIT $D054, 2  WPOKE $D058, ◊…ƒ‘»  POKE $D05E, ◊…ƒ‘» / 2  POKE $D021, 14  POKE $D020, 0  RETURN'---------------.RUNSTOPØTRAPPER'---------------  ' IF ER<>30 THEN RESUME  ' IGNORE EVERYTHING EXCEPT RUN/STOP  MYØERR$ = "?" + ERR$(ER) + " IN LINE " + STR$(EL).CLEANUP  PRINT "ì";MYØERR$  TRAP  KEY ON  POKE $D054, BKPØD054&  POKE $D058, BKPØD058&  POKE $D059, BKPØD059&  POKE $D05E, BKPØD05E&  END'---------.DRAWØTEXT'---------  BANK 0  POKE $7E0D, TX  POKE $7E0E, TY  POKE $7E0F, TCLR   SYS $7F03, 0, APTRØLO, APTRØHI  BANK 128  RETURN'---------------------.STOREØDEFAULTØCOLOURS'---------------------  FOR K = 0 TO 255    DEFAULTØRED&(K) = PEEK($D100+K)    DEFAULTØGREEN&(K) = PEEK($D200+K)    DEFAULTØBLUE&(K) = PEEK($D300+K)  NEXT K  RETURN'-----------------------.RESTOREØDEFAULTØCOLOURS'-----------------------  FOR K = 0 TO 255    POKE $D100+K, DEFAULTØRED&(K)    POKE $D200+K, DEFAULTØGREEN&(K)    POKE $D300+K, DEFAULTØBLUE&(K)  NEXT K  RETURN'---------------------.HANDLEØCOLOURØCYCLING'---------------------  VSYNC 230  BANK 0  SYS $7F21, SLICE*16, 16  BANK 128  GET A$  IF A$ = "" THEN GOTO HANDLEØCOLOURØCYCLING  GOSUB RESTOREØDEFAULTØCOLOURS  RETURN