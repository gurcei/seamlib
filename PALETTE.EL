#OUTPUT "PALETTE"'--------.DECLARES'--------#DECLARE BKPØD054&, BKPØD058&, BKPØD059&, BKPØD05E&#DECLARE K, A$, X, Y, CX, CY, CURSORØCLR#DECLARE CURSORØSTATE, TX, TY, TCLR, CHR, CIDX#DECLARE RED, GREEN, BLUE, RED$, GREEN$, BLUE$#DECLARE SELØIDX, IDX, REVØFLAG, SELØVAL#DECLARE ALTØKEY, CLIPØRED, CLIPØGREEN, CLIPØBLUE'-------.DEFINES'-------#DEFINE À≈ŸØ≈”√¡–≈ = CHR$(27)#DEFINE ◊…ƒ‘» = 200#DEFINE œ–Ø√œ–Ÿ = 0#DEFINE œ–ØÕ…ÿ  = 1#DEFINE œ–Ø”◊¡– = 2#DEFINE œ–Ø∆…ÃÃ = 3#DEFINE À≈ŸØ’– = "ë"#DEFINE À≈ŸØƒœ◊Œ = ""#DEFINE À≈ŸØÃ≈∆‘ = "ù"#DEFINE À≈ŸØ“…«»‘ = ""#DEFINE À≈ŸØ∆1 = "Ö"#DEFINE À≈ŸØ∆3 = "Ü"#DEFINE À≈ŸØ∆4 = "ä"#DEFINE À≈ŸØ∆5 = "á"#DEFINE À≈ŸØ∆7 = "à"#DEFINE À≈ŸØ∆8 = "å"#DEFINE À≈ŸØ≈”√ = CHR$(27)#DEFINE À≈ŸØ“≈÷ØœŒ = ""#DEFINE À≈ŸØ“≈÷Øœ∆∆ = "í"#DEFINE À≈ŸØ“≈‘’“Œ = CHR$(13)#DEFINE À≈ŸØÕ≈«¡Ø— = "´"#DEFINE À≈ŸØÕ≈«¡Ø√ = "º"#DEFINE À≈ŸØÕ≈«¡Ø÷ = "æ"' CURSOR STATES#DEFINE ”‘¡‘≈Ø”≈Ã≈√‘ = 0#DEFINE ”‘¡‘≈Ø≈ƒ…‘   = 1#DEFINE ”‘¡‘≈Ø≈ÿ…‘   = 2TRAP RUNSTOPØTRAPPER'----.MAIN'----  GOSUB INIT  GOSUB CLRSCREEN  GOSUB DRAWØPALETTE  GOSUB PARSEØINPUT  GOTO CLEANUP  END'----.INIT'----  ' √»“16 ON (FOR 16-BIT CHARS)  ' ∆√Ã“»… ON (ENABLE ”≈¡Õ FOR CHAR NUMBERS > $FF)  PRINT "ì";À≈ŸØ≈”√¡–≈;"5";    BKPØD054& = PEEK($D054)  BKPØD058& = PEEK($D058)  BKPØD059& = PEEK($D059)  BKPØD05E& = PEEK($D05E)  POKE $D054, $05   ' SET ”≈¡Õ MODE √»“16 + ∆√Ã“»…  WPOKE $D058, ◊…ƒ‘»  POKE $D05E, ◊…ƒ‘» / 2  POKE $D021, 14  POKE $D020, 0  ' $1000 = SOLID FCM CHAR  FOR K = 0 TO 63    POKE $40000 + K, $FF  NEXT K  ' $1001 = BOX CHAR  FOR K = 0 TO 63    IF INT(K / 8) = 0 OR INT(K / 8) = 7 THEN POKE $40040 + K, $FF:GOTO NXT    IF MOD(K, 8) = 0 OR MOD(K, 8) = 7 THEN POKE $40040 + K, $FF:GOTO NXT    POKE $40040 + K, $00.NXT  NEXT K  RETURN'---------------.RUNSTOPØTRAPPER'---------------  IF ER<>30 THEN RESUME  ' IGNORE EVERYTHING EXCEPT RUN/STOP.CLEANUP  TRAP  POKE $D054, BKPØD054&  POKE $D058, BKPØD058&  POKE $D059, BKPØD059&  POKE $D05E, BKPØD05E&  END'---------.CLRSCREEN'---------  EDMA œ–Ø∆…ÃÃ, ◊…ƒ‘» * 50, 0, $40800  EDMA œ–Ø∆…ÃÃ, ◊…ƒ‘» * 50, 0, $FF80000  ' CLEAR SCREEN  FOR Y = 0 TO 49   FOR X = 0 TO 79     WPOKE $40800 + Y * ◊…ƒ‘» + X * 2, 32   NEXT X  NEXT Y  RETURN'------------.DRAWØPALETTE'------------  ' DRAW X-INDEX  FOR X = 0 TO 15    IF X < 10 THEN WPOKE $40800 + X * 2 + 2, $30 + X    IF X >= 10 THEN WPOKE $40800 + X * 2 + 2, X - 9    WPOKE $FF80000 + X * 2 + 2, 0 * 256  NEXT X  ' DRAW Y-INDEX  FOR Y = 0 TO 15    IF Y < 10 THEN WPOKE $40800 + (Y+1) * ◊…ƒ‘», $30 + Y    IF Y >= 10 THEN WPOKE $40800 + (Y+1) * ◊…ƒ‘», Y - 9    WPOKE $FF80000 + (Y+1) * ◊…ƒ‘», 0 * 256  NEXT Y  ' DRAW BLOCKS FOR EACH COLOUR  FOR Y = 1 TO 16    FOR X = 1 TO 16      WPOKE $40800 + Y * ◊…ƒ‘» + X * 2, $1000      WPOKE $FF80000 + Y * ◊…ƒ‘» + X * 2, ((Y-1) * 16 + (X - 1)) * 256    NEXT X  NEXT Y  RETURN'-----------.PARSEØINPUT'-----------  DO WHILE 1    IF CURSORØSTATE = ”‘¡‘≈Ø”≈Ã≈√‘ THEN GOSUB STATEØSELECT    IF CURSORØSTATE = ”‘¡‘≈Ø≈ƒ…‘ THEN GOSUB STATEØEDIT    IF CURSORØSTATE = ”‘¡‘≈Ø≈ÿ…‘ THEN GOTO CLEANUP : END  LOOP  RETURN'------------.STATEØSELECT'------------  SELØIDX = -1 : GOSUB DRAWØRGBØVALUES  DO WHILE 1    GOSUB DRAWØCURSOR    GET A$    IF A$ = À≈ŸØ“…«»‘ THEN BEGIN      CX = CX + 1      IF CX = 16 THEN BEGIN        CX = 15        IF CY < 15 THEN CY = CY + 1 : CX = 0      BEND      SELØIDX = -1 : GOSUB DRAWØRGBØVALUES    BEND    IF A$ = À≈ŸØÃ≈∆‘ THEN BEGIN      CX = CX - 1      IF CX = -1 THEN BEGIN        CX = 0        IF CY > 0 THEN CY = CY - 1 : CX = 15      BEND      SELØIDX = -1 : GOSUB DRAWØRGBØVALUES    BEND    IF A$ = À≈ŸØ’– AND CY > 0 THEN CY = CY - 1 : SELØIDX = -1 : GOSUB DRAWØRGBØVALUES    IF A$ = À≈ŸØƒœ◊Œ AND CY < 15 THEN CY = CY + 1 : SELØIDX = -1 : GOSUB DRAWØRGBØVALUES    IF A$ = À≈ŸØ“≈‘’“Œ THEN CURSORØSTATE = ”‘¡‘≈Ø≈ƒ…‘ : EXIT    ' MEGA-Q = EXIT    IF A$ = À≈ŸØÕ≈«¡Ø— THEN BEGIN      TCLR = 0 : TX = 20 : TY = 3 : A$ = "QUIT: ARE YOU SURE? (Y/N)"      GOSUB DRAWØTEXT      GET KEY A$      IF A$="Y" THEN KEY ON : GOTO CLEANUP : ELSE BEGIN        TCLR = 0 : TX = 20 : TY = 3 : A$ = "                         "        GOSUB DRAWØTEXT      BEND    BEND    IF A$ = À≈ŸØÕ≈«¡Ø√ THEN BEGIN      CLIPØRED = RED      CLIPØGREEN = GREEN      CLIPØBLUE = BLUE    BEND    IF A$ = À≈ŸØÕ≈«¡Ø÷ THEN BEGIN      POKE $D100 + CIDX, CLIPØRED      POKE $D200 + CIDX, CLIPØGREEN      POKE $D300 + CIDX, CLIPØBLUE      SELØIDX = -1 : GOSUB DRAWØRGBØVALUES    BEND    CURSORØCLR = MOD(CURSORØCLR + 1, 16)  LOOP  RETURN'----------.STATEØEDIT'----------  SELØIDX = 0  DO WHILE 1    GOSUB DRAWØRGBØVALUES    GET KEY A$    ALTØKEY = PEEK($D611) AND 16    IF A$ = À≈ŸØƒœ◊Œ THEN SELØIDX = MOD(SELØIDX + 1, 3)    IF A$ = À≈ŸØ’– THEN SELØIDX = MOD(SELØIDX + 3 - 1, 3)    IF A$ = À≈ŸØÕ≈«¡Ø— THEN CURSORØSTATE = ”‘¡‘≈Ø”≈Ã≈√‘ : GOSUB CLEARØEDIT : EXIT    IF A$ = À≈ŸØ“…«»‘ THEN GOSUB INCRØVALUE    IF A$ = À≈ŸØÃ≈∆‘ THEN GOSUB DECRØVALUE  LOOP  RETURN'----------.CLEARØEDIT'----------  TCLR = 0 : TX = 20 : TY = 5 : A$ = "                   "  GOSUB DRAWØTEXT  TY = 6 : GOSUB DRAWØTEXT  TY = 7 : GOSUB DRAWØTEXT  TY = 8 : GOSUB DRAWØTEXT  TY = 9 : GOSUB DRAWØTEXT  RETURN'----------.INCRØVALUE'----------  IF SELØIDX = 0 THEN SELØVAL = DEC(RED$)  IF SELØIDX = 1 THEN SELØVAL = DEC(GREEN$)  IF SELØIDX = 2 THEN SELØVAL = DEC(BLUE$)    IF ALTØKEY <> 0 THEN SELØVAL = SELØVAL + 16 : ELSE SELØVAL = SELØVAL + 1  IF SELØVAL > 255 THEN SELØVAL = 255  SELØVAL = (SELØVAL AND $0F) * 16 + (SELØVAL >> 4)  IF SELØIDX = 0 THEN POKE $D100 + CIDX, SELØVAL  IF SELØIDX = 1 THEN POKE $D200 + CIDX, SELØVAL  IF SELØIDX = 2 THEN POKE $D300 + CIDX, SELØVAL  RETURN'----------.DECRØVALUE'----------  IF SELØIDX = 0 THEN SELØVAL = DEC(RED$)  IF SELØIDX = 1 THEN SELØVAL = DEC(GREEN$)  IF SELØIDX = 2 THEN SELØVAL = DEC(BLUE$)    IF ALTØKEY <> 0 THEN SELØVAL = SELØVAL - 16 : ELSE SELØVAL = SELØVAL - 1  IF SELØVAL < 0 THEN SELØVAL = 0  SELØVAL = (SELØVAL AND $0F) * 16 + (SELØVAL >> 4)  IF SELØIDX = 0 THEN POKE $D100 + CIDX, SELØVAL  IF SELØIDX = 1 THEN POKE $D200 + CIDX, SELØVAL  IF SELØIDX = 2 THEN POKE $D300 + CIDX, SELØVAL  RETURN'------------------.DRAWØCOLOURØNUMBER'------------------  A$ = "COLOR#: "  A$ = A$ + RIGHT$(HEX$(CY),1)  A$ = A$ + RIGHT$(HEX$(CX),1)  TCLR = 0 : TX = 20 : TY = 5  GOSUB DRAWØTEXT  RETURN'---------------.DRAWØRGBØVALUES'---------------  GOSUB DRAWØCOLOURØNUMBER  CIDX = CY * 16 + CX  RED = PEEK($D100 + CIDX)  GREEN = PEEK($D200 + CIDX)  BLUE = PEEK($D300 + CIDX)  RED$ = HEX$(RED)  RED$ = MID$(RED$,4,1) + MID$(RED$,3,1)  GREEN$ = HEX$(GREEN)  GREEN$ = MID$(GREEN$,4,1) + MID$(GREEN$,3,1)  BLUE$ = HEX$(BLUE)  BLUE$ = MID$(BLUE$,4,1) + MID$(BLUE$,3,1)  TCLR = 0 : TX = 20 : TY = 7 : A$ = "  RED: "  IF SELØIDX = 0 THEN A$ = A$ + À≈ŸØ“≈÷ØœŒ  A$ = A$ + RED$ + À≈ŸØ“≈÷Øœ∆∆  GOSUB DRAWØTEXT  TCLR = 0 : TX = 20 : TY = 8 : A$ = "GREEN: "  IF SELØIDX = 1 THEN A$ = A$ + À≈ŸØ“≈÷ØœŒ  A$ = A$ + GREEN$ + À≈ŸØ“≈÷Øœ∆∆  GOSUB DRAWØTEXT  TCLR = 0 : TX = 20 : TY = 9 : A$ = " BLUE: "  IF SELØIDX = 2 THEN A$ = A$ + À≈ŸØ“≈÷ØœŒ  A$ = A$ + BLUE$ + À≈ŸØ“≈÷Øœ∆∆  GOSUB DRAWØTEXT  FOR Y = 6 TO 9    FOR X = 35 TO 38      WPOKE $40800 + Y * ◊…ƒ‘» + X * 2, $1000      WPOKE $FF80000 + Y * ◊…ƒ‘» + X * 2, CIDX * 256    NEXT X  NEXT Y  RETURN'---------.DRAWØTEXT'---------  IDX = 0  REVØFLAG = 0  FOR K = 1 TO LEN(A$)    CHR = ASC(MID$(A$,K,1))    IF MID$(A$,K,1) = À≈ŸØ“≈÷ØœŒ THEN REVØFLAG = 1 : GOTO NXTDT    IF MID$(A$,K,1) = À≈ŸØ“≈÷Øœ∆∆ THEN REVØFLAG = 0 : GOTO NXTDT    GOSUB PETSCIIØTOØSCREENCODE    IF REVØFLAG = 1 THEN CHR = CHR OR $80    WPOKE $40800 + TY * ◊…ƒ‘» + (TX + IDX) * 2, CHR    POKE $FF80000 + TY * ◊…ƒ‘» + (TX + IDX) * 2 + 1, TCLR    IDX = IDX + 1.NXTDT  NEXT K  RETURN'---------------------.PETSCIIØTOØSCREENCODE'---------------------  IF CHR>=$00 AND CHR<=$1F THEN CHR = CHR OR $80 : RETURN  IF CHR>=$20 AND CHR<=$3F THEN RETURN  IF CHR>=$40 AND CHR<=$5F THEN CHR=CHR AND $BF : RETURN  IF CHR>=$60 AND CHR<=$7F THEN CHR=CHR AND $DF : RETURN  IF CHR>=$80 AND CHR<=$9F THEN CHR=CHR OR $40 : RETURN  IF CHR>=$A0 AND CHR<=$BF THEN CHR=(CHR AND $7F) OR $40 : RETURN  IF CHR>=$C0 AND CHR<=$FE THEN CHR=CHR AND $7F : RETURN  RETURN'-----------.DRAWØCURSOR'-----------  FOR Y = 0 TO 15    K = (CX + 1) * 8    IF CY <> Y THEN K = 80 * 8    ' PREPARE «œ‘œÿ CHAR    POKE $FF80000 + (Y + 1) * ◊…ƒ‘» + 160, %10010000  ' GOTOX BIT + TRANSP FLAG    WPOKE $40800 + (Y + 1) * ◊…ƒ‘» + 160, K    ' PREPARE CURSOR CHAR    WPOKE $FF80002 + (Y + 1) * ◊…ƒ‘» + 160, CURSORØCLR * 256  ' WHITE     WPOKE $40802 + (Y + 1) * ◊…ƒ‘» + 160, $1001    ' PREPARE «œ‘œÿ CHAR (TO OFF-SCREEN)    POKE $FF80004 + (Y + 1) * ◊…ƒ‘» + 160, %10010000  ' GOTOX BIT + TRANSP FLAG    WPOKE $40804 + (Y + 1) * ◊…ƒ‘» + 160, 80 * 8  NEXT Y  RETURN